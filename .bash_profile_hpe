####################
#   HPE SPECIFIC   #
####################

# Corporate proxy
CORP_PROXY="web-proxy.houston.hpecorp.net:8080"

# Find if it's linux what we are running
if [ "$(expr substr $(uname -s) 1 5)" == "Linux" ]; then
    IS_LINUX_OS=true
else
    IS_LINUX_OS=false
fi

# Find if it's on the HPE network
if [ "$IS_LINUX_OS" = false ] && [ "$(ipconfig | grep -m 1 Suffix | awk '{ print $NF }')" == "americas.hpqcorp.net" ]; then
    IS_HPE_NETWORK=true
elif [ "$IS_LINUX_OS" = true ] && [ "$(ping -c 2 web-proxy.houston.hpecorp.net | grep -m 1 proxy | awk '{ print $1 }')" == "PING" ]; then
    IS_HPE_NETWORK=true
else
    IS_HPE_NETWORK=false
fi

# configure proxy for git while on corporate network
function proxy_on(){
    # on Windows env vars are UPPERCASE even in git bash
    export HTTP_PROXY="http://$CORP_PROXY/"
    export HTTPS_PROXY="https://$CORP_PROXY/"
    export http_proxy=$HTTP_PROXY
    export https_proxy=$HTTPS_PROXY

    # Additionals for FTP and ALL (needed in some environments)
    export {FTP,ALL}_PROXY="$CORP_PROXY"
    export {ftp,all}_proxy="$CORP_PROXY"

    export NO_PROXY="localhost,127.0.0.1,$USERDNSDOMAIN,192.168.99.100"

    # internal CA certificate in corporate environment
    export GIT_SSL_NO_VERIFY=1

    # env | grep -e _PROXY -e GIT_ | sort
    echo -e "Proxy-related environment variables set."
}

# remove proxy settings when off corporate network
function proxy_off(){
    variables=( \
        "PASSWORD" "PROXY_SERVER" "PROXY_PORT" \
        "HTTP_PROXY" "HTTPS_PROXY" "FTP_PROXY" "ALL_PROXY" \
        "http_proxy" "https_proxy" "ftp_proxy" "all_proxy" \
        "NO_PROXY" "GIT_CURL_VERBOSE" "GIT_SSL_NO_VERIFY" \
        )

    for i in "${variables[@]}"
    do
        unset $i
    done

    # env | grep -e _PROXY -e GIT_ | sort
    echo -e "Proxy-related environment variables removed."
}

# This enables proxy by default every time the shell opens
# to disable, just run "proxy_off"
if [ "$IS_HPE_NETWORK" = true ]; then
    proxy_on
fi
